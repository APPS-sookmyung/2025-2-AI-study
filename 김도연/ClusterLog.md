# 논문 리뷰: _ClusterLog: Clustering Logs for Effective Log-based Anomaly Detection_

## 1) 연구 배경

- HPC/클라우드 등 대규모 분산 시스템에서는 파일 시스템 로그 기반 이상 탐지의 정확성과 시의성이 매우 중요
- 그러나 Lustre·BeeGFS 같은 병렬 파일 시스템(PFS)은 세션/블록 ID가 없고 시계 스큐·스레드 인터리빙으로 로그 순서가 모호하여, DeepLog 같은 “순차 학습 기반” 방법이 그대로 적용되기 어려움.

## 2) 기여(Contribution)

- **ClusterLog**: 로그 키를 **의미 임베딩+감성(부정/비부정) 신호**로 표현한 뒤 **DBSCAN**으로 유사 로그를 클러스터링하여 **고유 키 수를 줄이는 전처리**를 제안.
- 전처리 후 생성된 **클러스터 ID 시퀀스**를 LSTM(DeepLog의 시퀀스 학습부)로 학습해 **노이즈 많은 PFS 로그**에서도 예측 성능과 데이터 효율성을 개선.
- HDFS(세션 가능)와 Lustre(세션 불가, 고노이즈) 모두에서 **SOTA 대비 개선** 및 **소량 학습 데이터**에서도 안정적 성능을 입증.

## 3) 방법론(Methodology)

### 3.1 전처리

- 로그에서 시간·ID 등 변동 요소를 제거하고 **자연어 텍스트**만 남겨 **로그 키**를 생성.

### 3.2 의미 임베딩 + 감성 예측

- **Sentence Transformers all-mpnet-base-v2**로 768차 임베딩 생성.
- SentiLog의 **감성 분류기(0/1)** 출력을 임베딩에 **concat**하여 “의미는 유사하지만 정/부정 성격이 다른 로그”를 분리.

### 3.3 클러스터링

- **DBSCAN** 채택: K-Means는 K 사전지정과 미지 로그의 강제 배정 문제가 있어 배제.
- Epsilon(ε) 튜닝을 통해 **밀도 단층(ledge)** 지점을 찾아 임계값 선정.
- **min_samples=1**로 노이즈 라벨(-1) 생성 대신 단독 클러스터로 보존.

### 3.4 다운스트림 시퀀스 학습

- DeepLog의 2-레이어 LSTM을 사용, **윈도우 10**으로 다음 토큰(클러스터 ID) 분포를 예측.
- 후보 상한(top-k)을 **클러스터 수가 작을 때 적응적으로 축소**하여 거짓 음성 방지.

## 4) 실험 결과(Results)

- **데이터셋**
  - **Lustre**: PFault로 결함 주입해 라벨링(정상 150,473 / 이상 7,401, 키 73).
  - **HDFS**: 공개 벤치마크(575,139 세션 중 16,808 이상).
- **성능 분석**
  - 감성 신호 + ε 적절화 + 가변 top-k 조합 시 **F1 범위가 넓고 안정적**.
  - **HDFS**: Recall ↑, Precision은 유사, 종합 **F1 개선**.
  - **Lustre**: Precision·Recall 모두 향상, DeepLog 대비 우세.
  - **학습 데이터 축소(1%)**: DeepLog 성능 급락, ClusterLog는 **성능 유지**.

> ClusterLog의 예비 결과는 중요한 시퀀스 정보의 손실 없이 로그 시퀀스의 복잡도를 효과적으로 줄였고, 동시에 다양한 파일 시스템 로그에도 적용 가능한 일반화 가능성을 보여주었다.

## 5) 한계 & 의문점

- **임베딩 품질 의존성**: 도메인 특화 파인튜닝 없이는 일반 언어모델이 전문 로그를 제대로 구분할지 의문.
- **하이퍼파라미터 탐색 비용**: ε 선택을 수작업 가이드에 의존, 자동화 부족.
- **실시간 처리성**: 대규모 스트림에서 임베딩+DBSCAN 온라인 처리 가능성 불투명.
- **도메인 일반화 한계**: Kubernetes 등 교차 도메인 검증 미흡.

> 논문에서는 구체적인 한계점에 대한 명시적인 언급은 없다 하지만 예비 결과(preliminary results)라는 표현을 통해 이 연구가 제안 기법의 가능성을 입증한 초기 단계 연구임을 알 수 있었다.

## 6) 비판/해석

⚠️ **감성 신호의 타당성 문제**

- “부정=장애, 긍정=정상”이라는 단순 가정은 불완전.
- 오류 심각도 다중 등급(info/warn/error 등)이나 도메인 사전 기반 신호가 더 적합할 수 있음.

⚠️ **클러스터 안정성 문제**

- DBSCAN은 신규 로그 등장 시 클러스터 경계가 쉽게 변함 → 운영 환경에서 **ID 드리프트** 발생 가능.
- 증분 클러스터링(HDBSCAN\*, DenStream 등)이나 프로토타입 기반 정책이 필요.

💡 **ClusterLog의 접근 방식** - 기존 방법들이 겪어온 시간 기반 시퀀스의 불규칙성 문제를, 의미적 유사성에 기반한 클러스터링으로 풀어내려는 새로운 시도로 평가할 수 있음. 이는 로그 분석에서 시간적 순서보다 의미적 관계를 더 중시하는, 새로운 분석 패러다임을 제시한다는 점에서 의미가 큼

## 7) 종합 정리

- **핵심 아이디어**: “모델을 바꾸기 전, 로그 시퀀스를 클러스터링으로 정리해 학습 효율을 높이자.”
- **효과**: 세션 ID 없는 **고노이즈 로그**에서 정확도·데이터 효율성 동시 개선.
- **시사점**:
  - 도메인 적합 임베딩/감성 신호 중요,
  - 클러스터 파라미터 관리 및 드리프트 대응 필요,
  - 운영자 친화적 설명 기능 제공 필수.
